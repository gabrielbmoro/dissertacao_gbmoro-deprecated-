# -*- coding: utf-8 -*-
# -*- mode: org -*-
#+startup: beamer
#+STARTUP: overview
#+STARTUP: indent
#+TAGS: noexport(n)

# Impact on Intranode and Internode Communication
#+Title: Retrospective: September to December
#+Author: Gabriel B. Moro @@latex:\\@@ gabriel.bmoro@inf.ufrgs.br
#+Date: Porto Alegre, December 2016

#+LaTeX_CLASS: beamer
#+LaTeX_CLASS_OPTIONS: [12pt,xcolor=dvipsnames,presentation]
#+OPTIONS:   H:3 num:t toc:nil \n:nil @:t ::t |:t ^:t -:t f:t *:t <:t
#+STARTUP: beamer overview indent
#+LATEX_HEADER: \usepackage{tikz}
#+LATEX_HEADER: \usepackage{perpage}
#+LATEX_HEADER: \usetikzlibrary{arrows,shapes}
#+LATEX_HEADER: \input{org-babel-style-preembule.tex}
#+LATEX_HEADER: \institute[]{
#+LATEX_HEADER:   \includegraphics[width=.16\textwidth]{img/gppd.png}
#+LATEX_HEADER:   \hfill
#+LATEX_HEADER:   \includegraphics[width=.16\textwidth]{img/inf.pdf}
#+LATEX_HEADER:   \hfill
#+LATEX_HEADER:   \includegraphics[width=.16\textwidth]{img/ufrgs.pdf}
#+LATEX_HEADER:   \hfill
#+LATEX_HEADER:   \includegraphics[width=.26\textwidth]{img/hpe.jpg}
#+LATEX_HEADER: }
#+LaTeX: \input{org-babel-document-preembule.tex}
#+LaTeX: \newcommand{\prettysmall}[1]{\fontsize{#1}{#1}\selectfont}

#+LaTeX: \tikzstyle{format} = [draw, thin, fill=blue!20]
#+LaTeX: \tikzstyle{medium} = [ellipse, draw, thin, fill=green!20, minimum height=2.5em]


* Methodology
** 
*** Methodology

\begin{tikzpicture}

\node at (0,17) [draw,rectangle,rectangle left angle=70,rectangle right angle=-70,minimum height=1cm, fill=orange!20] (App) {App};
\node at (2.4,18) [draw,rectangle split, rectangle split horizontal,rectangle split parts=3,minimum height=1cm,fill=gray!10] (Lik) {\nodepart{two}\shortstack{Likwid\\}};
\node at (2.4,16) [draw,rectangle split, rectangle split horizontal,rectangle split parts=3,minimum height=1cm,fill=gray!10] (Sc) {\nodepart{two}\shortstack{Score-p\\}};
\node at (5.4,18) [draw,trapezium,trapezium left angle=70,trapezium right angle=-70,minimum height=1cm] (T1) {Trace};
\node at (5.4,16) [draw,trapezium,trapezium left angle=70,trapezium right angle=-70,minimum height=1cm] (T2) {Trace};
\node at (9.4,17) [draw,rectangle,rectangle left angle=70,rectangle right angle=-70,minimum height=1cm,rounded corners,fill=green!20] (Det){\shortstack{Detect Memory-Bound\\ Regions}};

\draw[->] (App.east) + (-1,1.1) coordinate (a1) ++ (0.02,0.12) -- (Lik.west |- a1);
\draw[->] (App.east) + (-1,-0.9) coordinate (a1) ++ (0.02,0.12) -- (Sc.west |- a1);
\draw[->] (Lik.west) + (2.35,0.02) coordinate (a1) -- (T1.west |- a1);
\draw[->] (Sc.west) + (2.52,0.02) coordinate (a1) -- (T2.west |- a1);
\draw[->] (T1.east) + (-1,-0.3) coordinate (a1) ++ (0.02,0.12) -- (Det.west |- a1);
\draw[->] (T2.east) + (-1,0.4) coordinate (a1) ++ (0.02,0.12) -- (Det.west |- a1);


\end{tikzpicture}

*** Use of the Likwid

#+LaTeX: \begin{columns}\begin{column}{.45\linewidth}
\begin{figure}[!htb]
\includegraphics[width=\linewidth]{../../producao/2016_wsppd/img/ft_L2_L3_100ms.pdf}
\caption{Sampling interval - 100 milliseconds$^{[1]}$.}
\label{figFT}
\end{figure}

#+LaTeX: \end{column}
#+LaTeX: \begin{column}{.35\linewidth}
#+LaTeX: {\small
	=Beagle1:=
		- 2 x Intel (R) Xeon (R) E5-2650 CPU 2.00 GHz
		  - 8 physical cores
		  - Hyper-Threading tecnology
#+LaTeX:}
#+LaTeX: \end{column}
#+LaTeX: \end{columns}

\vspace{2cm}
\hline
\vspace{0.2cm}
\tiny $^{[1]}$ *Moro, Gabriel and Schnorr, Lucas*. /Measuring Hardware Counters for
HPC Application Phase Detection/. XIV Workshop de Processamento
Paralelo e Distribuído. Porto Alegre, 2016.

*** Use of the Likwid

#+LaTeX: \begin{columns}\begin{column}{.45\linewidth}
\begin{figure}[!htb]
\includegraphics[width=\linewidth]{../../producao/2016_wsppd/img/lu_L2_L3_100ms.pdf}
\caption{Sampling interval - 100 milliseconds$^{[1]}$.}
\label{figFT}
\end{figure}

#+LaTeX: \end{column}
#+LaTeX: \begin{column}{.35\linewidth}
#+LaTeX: {\small
	=Beagle1:=
		- 2 x Intel (R) Xeon (R) E5-2650 CPU 2.00 GHz
		  - 8 physical cores
		  - Hyper-Threading tecnology
#+LaTeX:}
#+LaTeX: \end{column}
#+LaTeX: \end{columns}

\vspace{2cm}
\hline
\vspace{0.2cm}
\tiny $^{[1]}$ *Moro, Gabriel and Schnorr, Lucas*. /Measuring Hardware Counters for
HPC Application Phase Detection/. XIV Workshop de Processamento
Paralelo e Distribuído. Porto Alegre, 2016.

*** Use of the Score-p

#+LaTeX: \begin{columns}\begin{column}{.45\linewidth}

*Measures investigated*

- Acesses to Cache L2
- Amount of Misses in Cache L2

*Trace Generated*

|-----+------------------+---------------|
| _App_ | _Trace's Size_     | _Trace's Size_  |
|     | (without filter) | (with filter) |
|-----+------------------+---------------|
| CG  | 556M             | 202M          |
| FT  | 11M              | 3.7M          |
| LU  | 20G              | 6.5G          |
|-----+------------------+---------------|

#+LaTeX: \end{column}
#+LaTeX: \begin{column}{.35\linewidth}
#+LaTeX: {\small
	=Hype2:=
		- 2 x Intel (R) Xeon (R) E5-2650 CPU 2.30 GHz
		  - 20 physical cores
		  - Hyper-Threading tecnology
#+LaTeX:}
#+LaTeX: \end{column}
#+LaTeX: \end{columns}

* Preliminary Results
** 
*** Trace's Format

|---------------------+-------+-----------+--------------+-------|
| =Region=              | =File=  | =Code Line= | =Metric=       | =Value= |
|---------------------|-------|-----------|--------------|-------|
| omp-parallel        | cg.f  |       736 | PAPIL2TCA    | 48282 |
| omp-parallel        | ,cg.f |       736 | PAPIL2DCM    |  5288 |
| omp-parallel        | cg.f  |       736 | PAPIL2ICM    |  8933 |
| omp-do              | cg.f  |       736 | PAPIL2TCA    | 48841 |
| omp-do              | cg.f  |       736 | PAPIL2DCM    |  5393 |
| omp-do              | cg.f  |       736 | PAPIL2ICM    |  9092 |
| omp-implicitbarrier | cg.f  |       739 | PAPIL2TCA    |  1321 |
| omp-implicitbarrier | cg.f  |       739 | PAPIL2DCM156 |       |
| omp-implicitbarrier | cg.f  |       739 | PAPIL2ICM    |   523 |
| omp-parallel        | cg.f  |       736 | PAPIL2TCA    |  2048 |
| omp-parallel        | cg.f  |       736 | PAPIL2DCM    |   196 |
| omp-do              | cg.f  |       736 | PAPIL2TCA    |  2280 |
| ...                 |       |           |              |       |

** 
*** Preliminary Results


